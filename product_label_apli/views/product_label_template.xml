<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template 4x11 con precio -->
    <template id="report_producttemplatelabel4x11">
        <t t-call="web.basic_layout">
            <div class="page">
                <style>
                    .product-label-grid {
                        display: grid;
                        grid-template-columns: repeat(4, 1fr);
                        grid-template-rows: repeat(11, 1fr);
                        width: 100%;
                        height: 100%;
                        gap: 1mm;
                        padding: 0;
                        margin: 0;
                    }
                    .product-label {
                        border: 1px solid #ddd;
                        padding: 1mm;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        align-items: center;
                        text-align: center;
                        font-size: 10pt;
                        page-break-inside: avoid;
                        min-height: 25mm;
                    }
                    .product-name {
                        font-weight: bold;
                        font-size: 9pt;
                        margin-bottom: 1mm;
                        word-wrap: break-word;
                        max-width: 100%;
                    }
                    .product-code {
                        font-size: 8pt;
                        color: #666;
                        margin-bottom: 1mm;
                    }
                    .product-barcode {
                        margin: 1mm 0;
                    }
                    .product-price {
                        font-size: 12pt;
                        font-weight: bold;
                        color: #000;
                        margin-top: 1mm;
                    }
                </style>
                
                <div class="product-label-grid">
                    <t t-foreach="docs" t-as="product">
                        <!-- Repetir la etiqueta para cada cantidad solicitada -->
                        <t t-set="quantity" t-value="quantity if quantity else 1"/>
                        <t t-foreach="range(int(quantity))" t-as="q">
                            <div class="product-label">
                                <!-- Nombre del producto -->
                                <div class="product-name">
                                    <t t-esc="product.name"/>
                                </div>
                                
                                <!-- Código interno del producto -->
                                <div class="product-code" t-if="product.default_code">
                                    <t t-esc="product.default_code"/>
                                </div>
                                
                                <!-- Código de barras -->
                                <div class="product-barcode" t-if="product.barcode">
                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('EAN13', product.barcode, 200, 60)" 
                                         style="max-width: 100%; height: auto;"/>
                                </div>
                                
                                <!-- Precio -->
                                <div class="product-price">
                                    <t t-esc="product.list_price" t-options="{'widget': 'monetary', 'display_currency': product.currency_id}"/>
                                </div>
                            </div>
                        </t>
                    </t>
                    
                    <!-- Rellenar celdas vacías hasta completar 44 etiquetas (4x11) -->
                    <t t-set="total_labels" t-value="sum([int(quantity if quantity else 1) for product in docs])"/>
                    <t t-set="empty_labels" t-value="44 - (total_labels % 44) if total_labels % 44 != 0 else 0"/>
                    <t t-foreach="range(int(empty_labels))" t-as="e">
                        <div class="product-label" style="border: none;"/>
                    </t>
                </div>
            </div>
        </t>
    </template>
</odoo>
